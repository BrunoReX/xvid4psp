
  +----------------------------------------------------------------------------------------+
  |                                                                                        |
  |   SmoothAdjust plugin: SmoothLevels(), SmoothTweak(), SmoothCurve() & SmoothCustom()   |
  |                                                                                        |
  |                            v2.00 pre-release by "LaTo INV."                            |
  |                                                                                        |
  |                                    12 october 2011                                     |
  |                                                                                        |
  +----------------------------------------------------------------------------------------+



 DESCRIPTION :
 =============

  SmoothAdjust is a set of 4 plugins to make YUV adjustements:
   - SmoothLevels allows to change levels & gamma with optional limiting
   - SmoothTweak  allows to change brightness, contrast, saturation & hue
   - SmoothCurve  allows to change a plane according to a fixed curve
   - SmoothCustom allows to change a plane according to a custom expression

  These 4 plugins have a smoothing & dithering algorithm to avoid banding issue.
  Calculations are made in 32bits to avoid rounding errors and artifacts.
  SmoothAdjust is multithreaded (max 16 threads by plane) and optimized (SSE2/AVX).

  MSVC & ICL builds are provided for x86 & x64 platforms.



 REQUIREMENTS :
 ==============
   
  - Avisynth 2.5.x or Avisynth 2.6.x
  - YUV Planar (Y8, YV411, YV12, YV16, YV24)
  - 8bits or 16bits(MSB/LSB)



 CHANGELOG :
 ===========

  - v2.00 prere: fixed a bug with TVrange
                 added grid in debug view

  - v2.00 beta9: added TVrange parameter
                 added full decimals support in SmoothCurve
                 rewritted the parser in SmoothCurve (more robust)
                 changed defaults in SmoothLevels
                 fixed a bug with Ecenter in SmoothLevels16
                 added "pi" constant in SmoothCustom
                 cleaned the code

  - v2.00 beta8: added "scale" parameter for debug view
                 relaxed minimum frame size (128 for AVX & 64 for SSE2)
                 added sinh, cosh & tanh in SmoothCustom

  - v2.00 beta7: improved debug view
                 tweaked smoothing

  - v2.00 beta6: added SmoothCustom

  - v2.00 beta5: tweaked AVX support
                 fixed clamping bug in SmoothLevels
                 fixed interp scaling in SmoothCurve
                 added decimals support in SmoothCurve

  - v2.00 beta4: fixed YV16 & YV24 support
                 added Y8 & YV411 support

  - v2.00 beta3: fixed misaligned clip in AVX
                 finished 16bits support (stacked MSB/LSB)

  - v2.00 beta2: tweaked smoothing algorithm
                 fixed crash with mod4 clip
                 fixed freeze in debug view
                 tweaked speed when smooth=0

  - v2.00 beta1: fixed a bug that disable optimization
                 fixed a bug in AVX code
                 added avisynth 2.6.x support (and YV16/YV24 support)
                 decreased default strength: "smooth=50"

  - v2.00 alpha: improved smoothing algorithm
                 deleted Smode parameter
                 added AVX code
                 switched from ICL11 to ICL12
                 reduced startup delay
                 prepared higher bitdepth support (up to 16bits)
                 changed a lot of code
                 cleaned the code

  - v1.74: updated preset="tv2pc" & preset="pc2tv"
           fixed a bug in smoothing algorithm

  - v1.70: added curve in debug mode for SmoothLevels

  - v1.68: improved multithreading

  - v1.64: fixed cache problem with UV planes

  - v1.62: fixed crash with misaligned clip
           added MOD2 support

  - v1.60: improved startup time
           fixed MOD4 error message
           tweaked various things
           added ICC11 build

  - v1.56: added SSSE3 code
           changed CPU detection routine

  - v1.52: added SSE2 code (Smode=1 is 2x faster & Smode=2 is 3x faster)
           added useopt parameter

  - v1.46: tweaked smoothing code
           removed useless Smode=1 & Smode=2
           prepared support for YV16 & YV24 in Avisynth 2.6.x
           switched from VS2008 to VS2010

  - v1.44: added screenW & screenH for debugview
           fixed a bug in font drawing
           cleaned code

  - v1.40: added debugview (see show=true)

  - v1.30: fixed a bug in spline interpolation
           cleaned various stuff

  - v1.26: Smode=3 is now the default (instead of Smode=1)
           tweaked smoothing sensitivity
           updated documentation about Smode

  - v1.24: added new interpolation mode for SmoothCurve (see interp)

  - v1.18: tweaked Smode 3 & 4
           updated avisynth header

  - v1.16: replaced Smode 3 & 4 with stronger smoothing function
           changed minors things

  - v1.02: added x64 build
           fixed a bug in SmoothLevels

  - v1.00: first public release



 USAGE :
 =======

  - SmoothLevels( input_low, gamma, input_high, output_low, output_high, chroma, limiter, TVrange, preset,
                  Lmode, darkSTR, brightSTR, Ecurve, Ecenter, protect,
                  smooth, dither, useMT, useOPT, show, screenW, screenH, scale )

  - SmoothTweak( brightness, contrast, saturation, hue1, hue2, limiter, TVrange,
                 smooth, dither, useMT, useOPT, show, screenW, screenH, scale )

  - SmoothCurve( Ycurve, Ucurve, Vcurve, interp, limiter, TVrange,
                 smooth, dither, useMT, useOPT, show, screenW, screenH, scale )

  - SmoothCustom( Yexpr, Uexpr, Vexpr, limiter, TVrange,
                  smooth, dither, useMT, useOPT, show, screenW, screenH, scale )

  - SmoothLevels16(...), SmoothTweak16(...), SmoothCurve16(...), SmoothCustom16(...) for 16 bits



 COMMON SETTINGS :
 =================

    smooth [default: 100]
    ---------------------
     Strength of the smoothing
     0   = disable (faster +++)
     1   = weak
     xx  = intermediary
     200 = strong

    dither [default: 50]
    --------------------
     Type of the dithering
     -1  = dithering OFF
     0   = pattern
     xx  = intermediary
     100 = noise

    useMT [default: -1]
    -------------------
     Use multithreading if necessary
     -1 = automatic choice
     0  = multithreading OFF
     xx = xx threads for each plane (max = 16 threads per plane)

    useOPT [default: -1]
    --------------------
     Use SSE2/AVX optimization when available
     -1 = automatic choice
     0  = use C code
     1  = use SSE2 code
     2  = use AVX code

    show [default: false]
    ---------------------
     Show the debug view at fullscreen resolution

    screenW / screenH [default: -1 / -1]
    ------------------------------------
     Specific screen resolution for debug view

    scale [default: true]
    ---------------------
     Auto-scale the size of parameters in debug view
   


 SMOOTHLEVELS - GENERAL SETTINGS :
 =================================

    levels parameters [default: 16, 1.0, 235, 16, 235]
    --------------------------------------------------
     input_low   [0-255]
     gamma       [> 0.0]
     input_high  [0-255]
     output_low  [0-255]
     output_high [0-255]

    chroma [default: 100]
    ---------------------
     Strength for chroma (conversion based on levels parameters)
      0   = no chroma processing
      xx  = weak
      100 = normal chroma processing
      xx  = strong
      200 = maximum chroma processing

    limiter [default: 0]
    --------------------
     Clamp the output values
      0 = no limiter
      1 = clamp to output_low/output_high
      2 = clamp to 16-235 for luma & 16-240 for chroma

    TVrange [default: true]
    -----------------------
     Range of the clip (affects only limiting, see Lmode)

    preset [default: "default"]
    ---------------------------
     "fullrange" = use "0, 1.0, 255, 0, 255" as default levels
     "pc2tv"     = PC -> TV conversion
     "tv2pc"     = TV -> PC conversion



 SMOOTHLEVELS - LIMITING SETTINGS :
 ==================================

    Lmode [default: 0]
    ------------------
     Mode to reduce conversion on special areas for better looking result
      0 = no limiting
      1 = limit conversion on dark & bright areas (apply conversion @0%   at luma=0 & @100% at luma=Ecenter & @0% at luma=255)
      2 = limit conversion on dark areas          (apply conversion @0%   at luma=0 & @100% at luma=255)
      3 = limit conversion on bright areas        (apply conversion @100% at luma=0 & @0%   at luma=255)
     (If TVrange=true, 16 & 235 are used instead of 0 & 255)

    darkSTR [default: 100]
    ----------------------
     Strength for limiting: the higher, the more conversion are reduced on dark areas (for Lmode=1&2)

    brightSTR [default: 100]
    ------------------------
     Strength for limiting: the higher, the more conversion are reduced on bright areas (for Lmode=1&3)

    Ecurve [default: 0]
    -------------------
     Type of curve used for limiting
      0 = sine curve
      1 = linear curve

    Ecenter [default: 128]
    ----------------------
     Center of expression for Lmode=1

    protect [default: -1]
    ---------------------
     -1  = protecting off
     >=0 = black zone protection
           ---> don't apply conversion on pixels egal or below this value 
                (ex: with 16, the black areas like borders 
                     and generic are untouched so they don't look washed out)



 SMOOTHTWEAK SETTINGS :
 ======================

    brigthness [default: 0]
    -----------------------
     -255...0 = decrease the brigthness
     0...+255 = increase the brigthness

    contrast [default: 1.0]
    -----------------------
     0.0...1.0  = decrease the contrast
     1.0...10.0 = increase the contrast

    saturation [default: 1.0]
    -------------------------
     0.0...1.0  = decrease the saturation
     1.0...10.0 = increase the saturation

    hue1 [default: 0]
    -----------------
     -255...0 = shift the hue towards yellow
     0...+255 = shift the hue towards blue

    hue2 [default: 0]
    -----------------
     -255...0 = shift the hue towards green
     0...+255 = shift the hue towards red

    limiter [default: false]
    ------------------------
     Clamp the output to 16-235 for luma & 16-240 for chroma
      false = OFF
      true  = ON

    TVrange [default: true]
    -----------------------
     Range of the clip (affects only contrast adjustment)



 SMOOTHCURVE SETTINGS :
 ======================

    Ycurve [default: "0-0;255-255"]
    -------------------------------
     Curve for the Y plane (luma)
      Synthax: "a-b;c-d;e-f;..." a, c & e are source values and b, d & f are destination values
       ---> Examples: "0-0;255-255"  = do nothing
                      "0-255;255-0"  = invert the clip
                      "0-16;255-235" = PC to TV conversion
                      "0-0;16-0;235-255;255-255" = TV to PC conversion

    Ucurve [default: "0-0;255-255"]
    -------------------------------
     Curve for the U plane (chroma)

    Vcurve [default: "0-0;255-255"]
    -------------------------------
     Curve for the V plane (chroma)

    interp [default: 100]
    ---------------------
     Interpolation mode between control points
      0   = linear
      xx  = intermediary
      100 = cubic

    limiter [default: false]
    ------------------------
     Clamp the output to 16-235 for luma & 16-240 for chroma
      false = OFF
      true  = ON

    TVrange [default: 0]
    --------------------
     Convert the curves to TVrange(16-235/16-240) before applying conversion
      0 = OFF
      1 = ON, clip values outside TVrange
      2 = ON, process values outside TVrange



 SMOOTHCUSTOM SETTINGS :
 =======================

    Yexpr [default: "Y"]
    --------------------
     Expression for the Y plane (luma)

       ---> OPERATORS:
            ----------
            Arithmetic : ^ * / % + -
            Comparison : ! > < >= <= == != && ||
            Ternary    : ? :
            Constant   : pi

       ---> FUNCTIONS:
            ----------
            sin, cos, tan, asin, acos, atan, sinh, cosh, tanh, exp, log, ln, sqrt, abs, round, floor, ceil

       ---> Examples: "Y"     = do nothing
                      "255-Y" = invert the clip
                      "Y+32"  = adjust brightness
                      "Y*2"   = adjust contrast

    Uexpr [default: "U"]
    --------------------
     Expression for the U plane (chroma)

       ---> Example: "abs(U-128)+128"

    Vexpr [default: "V"]
    --------------------
     Expression for the V plane (chroma)

       ---> Example: "round(V/16)*16"

    limiter [default: false]
    ------------------------
     Clamp the output to 16-235 for luma & 16-240 for chroma
      false = OFF
      true  = ON

    TVrange [default: 0]
    --------------------
     Convert the expressions to TVrange(16-235/16-240) before applying conversion
      0 = OFF
      1 = ON, clip values outside TVrange
      2 = ON, process values outside TVrange


 16 BITS SETTINGS :
 ==================

    Some parameters must be mapped to the [0-65535] range before use:

      - SmoothLevels: input_low, input_high, output_low, output_high, Ecenter, protect

      - SmoothTweak: brightness, hue1, hue2, limiter

      - SmoothCurve: Ycurve, Ucurve, Vcurve

      - SmoothCustom: Yexpr, Uexpr, Vexpr


    For example: SmoothCurve("0-255;128-128;255-0") --> SmoothCurve16("0-65535;32768-32768;65535-0")
                 

