Рассмотрение вопроса кодирования кодеком XviD обязательно надо начинать со статьи [b]Alex T1000[/b] [url=http://dvdtocd.narod.ru/xvid.htm][size=14][b]Кодек Xvid. Основные понятия и настройки[/b][/size][/url]
Очень полезно прочесть и [url=http://friends-forum.com/forum/showthread.php?t=33680][b]Руководство по приготовлению DVD рипов программой VirtualDub-MPEG2 и кодеком XviD.[/b]
[/url]
Теперь после прочтения данного мануала, начнём с того, что в мире XviD мало чего поменялось с момента выхода в свет последнего билда [url=http://forum.doom9.org/showthread.php?t=135093] XviD+VAQ by Dark Shikari[/url] в 2008 году. Но всё же регулярно выходят пропатченные версии XviD различных разрботчиков и у многих рипперов возникают вопросы по кодированию XviD, в особенности где брать пропатченные билды с VAQ, а также особенности разнообразия профилей кодирования в связи с выходом XviD 1.3.0, обновленной уже несколько раз только в 2010 году с новым VAQ, хотя первые версии вышли уже 2 года назад. Поэтому вот и решил указать вам где это можно взять. Многие помнят матрицы квантования [b]Jawor[/b], так вот сей поляк и делает свои пропатченные билды. Скачать их можно [url=http://jawormat.republika.pl/xvid.html]здесь[/url].
Кому лень переводить его XviD FAQ, вот вам сокращенный перевод: 
[spoiler][quote]
[b]Xvid Builds FAQ[/b]

[b]БИЛДЫ[/b]

• Какой компилятор вы используете?
MingW32-GCC 3.4.5. Версии 4.x.x кажется, производят более медленные бинары и имеют тенденцию к miscompile некоторых программ. DirectShow decoder filter был построен с Visual C++ 2008 Express Edition.

• В чём отличие от ванильных билдов? Какие исправления Вы использовали?
Я включил DivX профили, Dark Shikari's VAQ и celtic_druid's MTK профили. Я изменил GUI, чтобы принять Отношение Снижения Кадра Frame Drop Ratio =-1, который отключает появление "real" N-VOPs.
Я включил VBV параметры для "(unrestricted)" профиля. Я возвратил опцию Closed GOV (которая может быть без контроля типов только для "unrestricted" профиля!). Я ввёл опцию Use 4MV (которая должен быть без контроля типов только для воспроизведения на shitty устройствах). Я увеличил максимальный номер зон до 255
Я заставил DirectShow decoder распознать дополнительно MPEG-4 FourCCs (3IVX, 3IV0, 3IV1, 3IV2, LMP4, RMP4, SMP4 and HDX4).

• Вы подключите cropping/resizing/deinterlacing/denoising фильтры в кодек? У DivX они есть!
Нет, я не буду. Это было бы бессмысленно. У AviSynth есть большие возможности в этом плане к программе, которые делают все эти вещи. Насколько я знаю, DivX - единственный популярный VfW кодек, у которого есть фильтры предварительной обработки. Xvid не должен конкурировать с DivX в каждом аспекте 

================================================
[b]ИНСТАЛЛЯТОРЫ[/b]

• я нуждаюсь в деинсталляции предыдущей версии Xvid, прежде чем выполнить *.exe инсталлятор?
Это строго рекомендуется. Если Вы не будете делать этого, вероятно ничто ужасное не случаться, но у Вас могут быть некоторые более не существенные ярлыки в Меню Пуска после этого.

• Как Вы создавали инсталляторы?
Я использовал Inno Setup .Это - великое (и бесплатное!) приложение, которое создает инсталляторы для Windows.

• Инсталляторы содержат бесплатный программный продукт с размещенной в них рекламой/спами /тулбарами.Они подключаются к интернету?
Нет. Я думаю, что помещение бесплатного программного продукта с размещенной в нем рекламой или инструментальных панелей в приложение GNU было бы неэтично, возможно даже незаконно. У Inno Setup даже нет "особенности" установки сети. Инсталляторы создают ярлыки для некоторого Xvid-связанного webpages в Меню Пуска (папка "Xvid"), но они не начаты автоматически.

• программа установки устанавливает службы или программы, которые будут работать при запуске Windows?
Нет.

• Почему программа установки изменяет Системный реестр?
Это имеет отношение ко всем кодер-декодерам VFW, они должны быть описаны в системном реестре, чтобы работать должным образом.

• Какие версии Windows поддержаны?
2000, XP и Vista. Инсталляторы могут воздействовать также на Сервер Windows 2003, Сервер Windows 2008 и Windows 7, но в настоящее время я не могу проверить это. 95/98/ME не поддержаны. Я строго советую пользователей этих устаревших систем модернизировать. Декодер DirectShow не воздействует на Windows 2000 (инсталлятор обнаруживает Windows 2000 и не устанавливает его). Это было проверено под XP SP2 и Vista (не SP).

=============================================================
[b]ПОДДЕРЖКА[/b]

• Где я могу получить справку и поддержку?
В разделе MPEG-4 ASP <http://forum.doom9.org/forumdisplay.php? f=52> на Форуме Doom9's <http://forum.doom9.org/>. Пожалуйста не посылайте мне личные сообщения, просящие поддержку. Только ищите информацию на форуме и, если Вы не будете находить ответ, запускайте новую тему.

============================================================
[b]КОДИРОВАНИЕ[/b]

• я могу использовать тот же самый метод кодирования, как с другими Xvid билдами?
Да. Вы можете использовать свое любимое приложение кодирования VFW в VirtualDub .

• Вы изменяли настройки по умолчанию?
Я изменил заданное по умолчанию Frame Drop Ratio от 0 до -1, потому что я думаю, что большинство людей не хотело бы N-VOPs в них, кодирует так или иначе (и если кто-то действительно будет хотеть N-VOPs, (s), то он будет вероятно знать то, для чего опция Frame Drop Ratio и как корректировать это). Я сделал "Advanced Simple @ L5" задавая по умолчанию конфигурация так, чтобы никто не мог ввернуть параметры настройки VBV случайно. Я не изменял никакие другие настройки по умолчанию.

• Каковы лучшие параметры настройки Xvid для того, чтобы кодировать?
Нет никаких "лучших" параметров настройки! Кодирование параметров настройки должно зависеть от видео источника и Ваших визуальных персональных настроек.

• OK, но... там какие-нибудь параметры настройки, которые Вы рекомендовали бы?
Используйте VHQ для B-кадров, он заставляет их выглядеть немного лучше. Поднимите значение VHQ, если у Вас есть еще некоторое время (чем выше значение VHQ, тем медленнее кодирование). Чтобы избежать превышения выходного размера, установите Минимум I/P/B-frame квантизатор к 2 (квантизатор 1 не значительно лучше, чем 2, это используется главным образом, чтобы предотвратить undersizing, но это иногда сверхкомпенсирует). Если Вы хотите выбрать определенный целевой выходной размер или среднее число bitrate, применяйте кодирование с двумя проходами.Это позволит получить намного лучшее видео по качеству, чем однопроходное кодирование с постоянным битрейтом. Если Вы кодируете видео для автономного "железного" DVD плейера, выбирайте конфигурации DIVX/XVID/MTK ниже.

• Кто-то сказал мне, что VHQ несовместим с DVD плейерами! Действительно ли это - правда?
Абсолютно нет! Это - только суеверие и невежество. VHQ - только лучший макроблоковый тип алгоритма выбора решения и более расширенный метод поиска движения. И между прочим, Trellis(квантование Решетки) - только более расширенный алгоритм квантования, таким образом это также полностью совместимо со всеми декодерами.

• Какие звуковые форматы я могу использовать с Xvid?
можно использовать почти любой формат, который Вы любите если Вы муксите аудио и видео в контейнере Matroska (*.mkv). Но для просмотра на DVD плейеерах Вы должны выбрать старый *.avi контейнер и MP3 или аудио AC3 .

• я могу использовать Xvid-закодированные файлы для авторинга ПРОИГРЫВАНИЯ ФИЛЬМОВ И АУДИО?
Нет. Xvid - кодек MPEG-4 ASP. Стандарт ПРОИГРЫВАНИЯ ФИЛЬМОВ И АУДИО позволяет только MPEG-1 и MPEG-2. Вы должны повторно закодировать своё видео (предпочтительно из Вашего оригинального источника). Для MPEG-2 кодирование Вы можете использовать CCE SP2 или Carbon Coder, который предлагают очень хорошее качество.

• Можно ли микшировать Xvid-закодированные файлы в *.mp4?
Да. YAMB <http://yamb.unite-video.com/> является бесплатным *.mp4 muxer. Помните, что большинство DVD плейеров не поддерживает *.mp4 контейнер.

• Можно ли микшировать Xvid-закодированные файлы в *.mkv?
Да. Фактически Вы должен, если Вы хотите использовать некоторые звуковые форматы (например. FLAC). MKVToolnix <http://www.bunkus.org/videotools/mkvtoolnix> является бесплатным Matroska muxer. Помните, что большинство большинство DVD плейеров не поддерживает контейнер Matroska

=======================================
[b]VAQ[/b]

• Какова эта вещь VAQ так или иначе?
"VAQ" означает "Дисперсионное Адаптивное Квантование". В основном это - алгоритм, который пытается оптимально выбрать квантизатор для каждого макроблока, используя некоторое расширенное математическое волшебство. Алгоритм был создан Dark Shikari <http://forum.doom9.org/member.php? u=83421> для x264 кодера и позже перенесенный к Xvid.

• Как я могу активизировать VAQ?
В опции Variance AQ (в версии 1.2.2 выберите) выберите вариант Variance-Masking или же аналогично в опции Adaptive Quantization (в 1.3.x версиях). В моем старом 1.2.x билде Вы должны проверить опцию Adaptive Quantization.

• Почему Вы удалили "normal" Adaptive Quantization из 1.2.x, билдов?
Это - способ, которым исправление VAQ было написано Dark Shikari (VAQ заменил старый AQ). В 1.3.x версиях GUI(графический интерфейс пользователя) был изменен, чтобы включать всплывающий список, который дает возможность Вам выбрать алгоритм AQ. Я не вижу никакого смысла в backporting, который встраивают эти изменения к 1.2.x, поскольку старое AQ не было очень хорошим так или иначе (обычно, это делало изображение хуже, особенно в темных областях).

• Работает ли VAQ хорошо со всеми матрицами квантования?
Это, кажется, работает вполне прилично с H.263, MPEG и EQM v3 HR. Но часто делает изображение немного хуже с моими матрицами. Проверьте это сами непосредственно. Ваше мнение может измениться.

• VAQ совместим с "железными" DVD плейерами?
Обычно. Это совместимо с Simple Profile @ Level 1 и выше. Xvid, DivX и конфигурации MTK также позволяют использовать это (кодер-декодер DivX использовал форму AQ, когда программа свидетельства проектировалась, таким образом DivX-гарантированные плейера должны поддержать это). Это, не гарантируют, что будет работать хорошо с "no name" плейерами, которые не удостоверены.

===================================
[b]DIVX 5 USER DATA, "USE 4MV" AND "CLOSED GOV"[/b]

• Что это за вещь "user data" данных и почему я должен заботиться?"
Пользовательская область" данных используется Xvid и DivX, чтобы сохранить информацию о версии кодер-декодера. Некоторые автономные DVD плейеры читают эту информацию и могут отказаться запустить файл, если пользовательская строка данных DivX отсутствует. Поэтому рекомендуется написать DivX 5 пользовательских данных, если мы намереваемся запустить наш рип на DVD плейере.

• я должен всегда подключать Use 4MV?
Нет, если Вы не кодируете для действительно дрянного устройства воспроизведения, которое не поддерживает макроблочный режим INTER4V.

• Что относительно Closed GOV?
Этот опция может быть только в "(unrestricted)" конфигурации. Оставьте это в покое, если Вы действительно не знаете то, что Вы делаете.

=========================================================
[b]DIVX ПРОФИЛИ[/b]

• Кто добавил конфигурации DivX к Xvid?
Разработчики Xvid's добавили их к приблизительно с версии1.0. Они были прокомментированы в исходном тексте впоследствии. Я возвращал их только, чтобы помочь неопытным людям. Эти конфигурации делают совместимые файлы для автономных DVD плейеров намного проще.

• Вы присоединены к DivX, Inc?
Нет. Если DivX, Inc <http://www.divx.com/> попросит, чтобы я удалил название "DivX" из этих конфигураций, я сделаю это. Насколько я знаю, параметры настройки, используемые в этих конфигурациях, не могут быть запатентованы, таким образом я не должен буду удалить эти конфигурации в целом.

• Вы можете гарантировать, что эти конфигурации совместимы с DivX-стандартом?
Нет. Но я приложил все усилия, чтобы сделать их совместимыми. Я использовал публично доступную информацию (такую как пользовательские руководства от вебсайта DivX <http://www.divx.com/>), чтобы создать их. Я не дизассемблировал бинарные наборы DivX, чтобы получить информацию.

• Что относительно DVD плейеров , которые не удостоверены DivX, Inc? Они запустят видео Xvid, созданные с этими конфигурациями?
Почти все DVD плейера с MPEG-4-поддержкой запустят такие файлы.

• Вы проверял файлы, созданные с этими конфигурациями на DVD плейере?
Да. Я использовал Philips DVP3142/12. Прекрасно проиграл все файлы.

• Можно ли мне микшировать видео, созданное с этими конфигурациями в *.divx файл?
Да. Возьмите AVIAddXSubs <http://www.calcitapp.com/AVIAddXSubs.php>, это - бесплатная утилита, которая не полагается на DivXMux. Фактически, Вы можете даже mux файлы с Qpel, GMC и другими "несовместимыми" особенностями с ним.

• я должен выбрать конфигурацию PAL ИЛИ NTSC?
Это зависит главным образом от разрешающей способности и FPS Вашего исходного видео. Для 720x576 и 25 FPS выбирают PAL, для 720x480, и 23.976/24/29.97/30 FPS выбирают NTSC.

• Что, если мой DivX-плейер не хочет запустить какие-нибудь файлы Xvid?
Измените коды FourCC в файле к "DIVX" Преобразователь использующего Nic's FourCC (это - приложение, включенное в пакет - ищут это в папке "Xvid" под Меню Начала). Вы можете вынудить Xvid использовать "DIVX" FourCC в Вашем, кодирует - только идите в "Other options -> Encoder -> FourCC used" " в диалоге конфигурации кодер-декодера, и выбирают "DIVX" из списка. Если "DIVX" не работает с Вашим DVD плейером, попробуйте "DX50".

• Почему бы не использовать DivX вместо XviD?
Бесплатный выпуск DivX испытывает недостаток в более расширенных алгоритмах поиска движения, включенных в Про версию. У DivX нет VAQ. DivX не позволяет Вам корректировать параметры B-frames (такие как отношение/смещение квантизатора и чувствительность). Xvid производит лучшее видео качество (это субъективно конечно).
=====================================================
[b]XVID ПРОФИЛИ[/b]
• Каковы они " Xvid профили"? Я никогда не слышал о них.
Эти конфигурации были определены в соответствии с Решениями Xvid <http://www.xvid.org/>. Они предназначаются для многих видов автономных устройств и аппаратных декодеров. Поскольку Вы, возможно, обратили внимание, они столь не ограничены как конфигурации DivX (они позволяют использование Qpel, квантование MPEG/MPEG-Custom и больше B-кадров). К сожалению программа свидетельства Xvid не так почти успешна как тот, созданный DivX, Inc (программа DivX была просто первой на рынке, и название "DivX" было намного больше рекомендовано тогда).

• Делают DivX-гарантированную поддержку плейеров конфигурации Xvid?
Не официально. DivX-плейера не обязаны поддерживать Qpel, GMC, квантование MPEG/MPEG-Custom и множественные B-кадры, но им не запрещают сделать это также. Многие DivX-гарантированные standalones (особенно более новые) поддерживают Qpel, множественность B-кадров и MPEG/MPEG-Custom. GMC Xvid's - самая проблематичная особенность (это более сложно чем GMC DivX's), автономные плейера не поддерживают это или запускают такие видео с экспонатами.

• у меня есть недешевый "no name" плейер, у которого есть некоторое Лого "Xvid". Это удостоверено в соответствии с Решениями Xvid?
Не обязательно. "No name" изготовители не использовало подобные эмблемы "Xvid" много лет. Их плейера вероятно не удостоверены в соответствии с Решениями Xvid или кем - либо еще. Эти standalones, как гарантируют, полностью не поддержат Xvid (или DivX) конфигурации. Вы должны проверить их сами. На Xvid защищают авторским правом, программное обеспечение и использование названия "Xvid" на таких продуктах могут быть незаконными.
=======================================================
[b]MTK ПРОФИЛИ[/b]

• Каковы эти профили MTK? Для чего они хороши?
"Профили MTK" были созданы celtic_druid <http://forum.doom9.org/member.php? u=190> от Форума Doom9's <http://forum.doom9.org/>. Они стремятся к совместимости с автономными DVD плейерами, использующими наборы микросхем MediaTek.

• Как я могу сказать, использует ли мой автономный DVD плейер набор микросхем MediaTek?
Ищите свой плейер здесь <http://www.videohelp.com/dvdplayers>. К сожалению информация о наборе микросхем не доступна для многих DVD плейеров (изготовители иногда не хотят обнародовать технические подробности их продуктов).

• Какую конфигурацию MTK я должен выбрать?
Если Вы хотите. чтобы ваш рип нормально воспроизводился бытовыми DVD плейерами, выберите  профиль по битрейту "PAL MTK" или "MTK NTSC" (для выбора PAL/NTSC, см., что DIVX ПРОФИЛИРУЕТ раздел). "PAL MTK 6000" и "MTK NTSC 6000" позволяет выше bitrates, и возможно, что Ваш DVD плейер не будет в состоянии обработать их.

=========================================
[b]XVID_ENCRAW[/b]

• я могу использовать Ваш xvidcore.dll с xvid_encraw?
Да. Если Ваша версия xvid_encraw не поддерживает --drop -1, использует специальные xvidcore.dll файлы, которые обрабатывают 0 как-1.

• Как я использую Ваш xvidcore.dll с xvid_encraw?
Ищите в Вашей xvid_encraw папке, резервируйте старый xvidcore.dll и поместите мой xvidcore.dll в папку.

===============================================
[b]ВОСПРОИЗВЕДЕНИЕ ЗАКОДИРОВАННОГО ВИДЕО НА PC[/b]

• Какой декодер я могу использовать, чтобы запустить моё Xvid-закодированные видео?
Новые пакеты содержат Xvid DirectShow decoder для Windows XP и выше (не 2000), но любой MPEG-4 ASP декодер выполнит (если файл не содержит ошибок). Если у Вас нет декодера (или недовольны с тем, который Вы получили), попробуйте ffdshow <http://ffdshow-tryout.sourceforge.net/>. Это является бесплатным и может декодировать много других форматов.

• Какого программный плейер Вы рекомендуете для видео Xvid?
Media Player Classic HomeCinema <http://mpc-hc.sourceforge.net/>. Забудьте об Универсальном проигрывателе Windows 

======================================================

[b]ВОСПРОИЗВЕДЕНИЕ ЗАКОДИРОВАННОГО ВИДЕО НА СТАЦИОНАРНЫХ ПРОИГРЫВАТЕЛЯХ[/b]

• Какой автономный DVD плейер лучший для того, чтобы запустить видео Xvid?
"Лучший" DVD плейер - тот, который лучше всего удовлетворяет Вас. Если Вы собираетесь покупать DVD плейер, ищите на VideoHelp <http://www.videohelp.com/dvdplayers> для возможностей, которых Вы желаете. И помните, Google <http://www.google.com/> является Вашим другом 

• Существует ли XviD видео, закодированное регион-кодом? Я нуждаюсь в DVD плейере мультизонном, чтобы запустить их?
Нет. Кодирование регион-кодом применяется только к BD и DVD.

• Мой DVD плейер не запускает *.avi / *.divx файлы, только "нормальные" DVD. Это запустит такие файлы после обновления встроенного программного обеспечения?
Нет. Набор микросхем ответственен по большей части за процесс декодирования видео. Это - специализированный MPEG декодерный чип, а не универсальный CPU как в PC. Вы не можете заставить это декодировать новые форматы сжатия видеоизображения, передавая некоторое новое программное обеспечение.

• Какой звуковой формат я должен использовать?
Все DVD плейера должны декодировать CBR MP3 в *.avi файлах. Большинство DVD плейеров также принимает VBR MP3 и CBR в AC3. DivX-DVD плейер также поддерживают "Аудио DivX", взломанный вариант Аудио Носителей Windows, который предлагает относительно низкое качество. Постоянная скорость передачи в битах MP3 в 128 kbps - вероятно самый безопасный выбор, но должным образом закодированный VBR MP3, может предложить лучшее качество. Перевыборка от 48000 Гц до 44100 Гц не должна быть необходимой.

• Какой формат субтитров я должен использовать?
Когда в сомнении, используйте SubRip (*.srt) формат и удалите все ПОДОБНЫЕ HTML тэги (некоторые игроки отображают их, как будто они были только нормальными символами). Много DVD плейеров поддерживают MicroDVD (*.txt), SubStation Alpha (*.ssa) и другие форматы, но разработанные тэги, и другие расширенные особенности обычно игнорируются. Это означает, что PC можно лучше удовлетворить для того, чтобы запустить Ваше аниме fansubs и караоке.[/quote][/spoiler]
Много полезной информации по кодированию XviD с новыми билдами можно подчерпнуть [url=http://www.xvidvideo.ru/xvid-video-codec/]здесь[/url] и скачать последние билды различных версий XviD.

===========================================================================

[b]Особенности кодирования кодеком XviD + VAQ[/b]

1. Для определения необходимо битрейта для кодирования вашего видео материала воспользуйтесь [b]"Методикой подбора битрейта под ваш исходник для получения оптимального по качеству рипа"[/b].

2. Минимальные квантизеры должны быть установлены следующим образом: [i]-imin 2 -pmin 2 -bmin 2[/i] . Для двухпроходногокодирования максимальные квантизеры выставлять специально не надо, а вот все минимальные лучше установить со значением "2". Фреймы с квантом "2" не будут выглядеть хуже, чем с "1", поскольку алгоритм управления скоростью кодека не всегда справляется с минимальными квантами "1" хорошо и можно получить негабаритный файл на выходе, кроме того с минимальным квантом "1" кодек делает распределение квантов хуже.Прежде всего подобная установка квантизеров выполняется при кодировании в аспект разрешения 4:3.

3. Минимальные квантизеры лучше установить следующим образом: [i]-imin 1 -pmin 1 -bmin 1[/i]  при условии, что вы отказались от применения указанной выше методики и вам необходимо обеспечить  точное попадание в заданный битрейт или размер.

4. Минимальные квантизеры для однопроходного кодирования должны быть установлены [b]-pmin 1 -bmin 3[/b].     Важным условием для попадания в заданный битрейт является установка [b]-pmin 1[/b]

5. Максимальные квантизеры нужно ограничить только на однопроходном кодировании, приблизительно до уровня [b]-imax 4 -pmax 4 -bmax 6[/b], иначе на более высоких значениях будут наблюдаться артефакты блочности изображения.

6. Адаптивное квантование распространяется только на P-frames с максимальным квантизером [b]-pmax 3[/b]
   а) Ключ опции [b]VAQ[/b] для версии 1.3.1 имеет вид: [b]-masking 2[/b] с возможностью включения старого адаптивного квантования: [b]-masking 1[/b]
   б) Ключ опции [b]VAQ[/b] для версии 1.2.2 имеет вид: [b]-lumimasking[/b] без выбора варианта.
Старая версия [b]VAQ[/b] пытается отдать меньший битпоток областям изображения, которые человеческий глаз не в состоянии увидеть достаточно хорошо, что позволит кодировщику потратить сэкономленные биты на более важные части картинки. Качество закодированного материала, привнесенное этой опцией, сильно зависит от личных предпочтений и от типа и настроек монитора, использовавшегося для просмотра (обычно результат выглядит не очень хорошо, если он яркий, или является TFT монитором). Новая версия [b]VAQ[/b] взята от кодека x264 и способствует лучшей упаковке p-frames c более низкими значениями квантов.

7. Для максимального попадания в заданный битрейт при однопроходном кодировании настройки кодека по CBR не совсем правильные: [b]-reaction 16 -averaging 100 -smoother 100[/b]. Лучше будет их установить [b]-reaction 60 -averaging 28 -smoother 28[/b]. При этом разброс в выходном битрейте значительно снизится.
  Однопроходный пресет имеет вид:
[code]-bitrate XXXX -qtype 0 -nopacked -metric 1 -reaction 60 -averaging 28 -smoother 28 -max_key_interval 250 -vhqmode 4 -pmin 1 -bmin 3 -max_bframes 2 -bvhq -bquant_ratio 162 -bquant_offset 0 -pmax 4 -bmax 6 -lumimasking[/code]
 Стоит однако учесть, что для улучшения качества p- и b-frames лучше всегда применять [b]-max_brames 2[/b], но для максимальной совместимости со стационарными плеерами рекомендуемая установка [b]-max_brames 1[/b].
 РЕКОМЕНДАЦИЯ: Внимательно следите за коэффициентом качества на однопроходном кодировании и не опускайте его ниже 0,2 бит\пиксель иначе из-за верхнего ограничения по квантам на p- и b-frames можно получить перерасход битрейта. Если на выбранном вами разрешении с заданным битрейтом идёт превышение последнего, лучше выбрать пресет с более высоким битрейтом или снизить ваше разрешение или как последний вариант увеличить ограничение максимальных квантов

8. Интервал между ключевыми кадрами должен быть 10*fps, т.е., напрмер, для 23,976 fps: [b]-max_key_interval 240[/b]

9. Если вы используете [i] -vbvmax 4854000 -vbvsize 3145728[/i] (величина для “DivX Home Theatre” профиля), кодек не будет нарушать нарушать ограничения “DivX Home Theatre” профиля.Рекомендуемые установки для второго прохода:
[code]-ostrength 5 -oimprove 5 -odegrade 5 -chigh 0 -clow 0 -vbvmax 4854000 -vbvsize 3145728 -imin 2 -bmin 2 -pmin 2[/code]

10. Опцию [b]-qpel[/b] желательно пока не включать. [b]qpel[/b] увеличивает количество предполагаемых векторов движения, путём повышения точности оценки движения с полупиксельной до четвертьпиксельной. Идея состоит в том, чтобы найти лучшие векторы движения, которые взамен уменьшат битпоток (тем самым увеличивая качество). Однако, векторы движения с четверьтпиксельной точностью требуют большего количества дополнительных бит для кодирования, а векторы-кандидаты не всегда дают (значительно) лучшие результаты. Достаточно часто кодек тратит дополнительные биты на повышенную точность впустую, а взамен получает или вообще ничего, или небольшое увеличение качества. К сожалению, нет способа предсказать возможные улучшения от qpel, так что Вам придется сделать кодирование с ней и без нее, чтобы знать наверняка.
[b]qpel[/b] может почти удвоить время кодирования и требует, как минимум, на 25% большей мощности при декодировании. Она поддерживается не всеми аппаратными проигрывателями.. Помните также, что применение [b]-vhqmode 4 -qpel[/b] приводят к сбою даже кодека XviD 1.2.2 . Так что применяйте [b]-vhqmode 1 -qpel[/b]. Общая рекомендация: отключено

11. Теперь о важном: максимально идущих подряд B-frames. Казалось бы надо ставить однозначно [b]-max_bframes 1[/b]. Но дело в том, что при установке [b]-max_bframes 2[/b] идёт прирост в качестве P- и B-frames на 22...24% за счёт перераспределения высвободившегося битрейта. Тут надо думать, что лучше, а вернее для боевиков, обработки SATRemux и низкокачественного видеоматериала лучше ставить [b]-max_bframes 2[/b], такая установка считается "золотой серединой", также подобную манипуляцию следует выполнить и для малых битрейтов, а для более статических видеоматериалов с незначительным движением применять [b]-max_bframes 1[/b]. Кроме того старые модели стационарных плейеров не поддерживают количество идущих подряд b-frames более 1. Проверьте свой плейер на данную совместимость.

12. Ещё подметил одну особенность с [b]-bquant_ratio[/b], который по умолчанию в XviD для VD составляет 150(1.50), а в CLI версиях 162. Некоторые гуру кодирования рекомендуют установить эту опцию [b]-bquant_ratio 100[/b]. При этом значительно возрастает качество B-frames. Аналогичный прирост в качестве  B-frames даёт опция:  [b]-bquant_ratio 162 -bquant_offset 0[/b]. Именно эта установка в настоящее время активно используется при кодировании. 

13. Ключ для новой опции XviD 1.3.X [b]VHQ metric: 1 - PSNR-HVS-M[/b] имеет вид: [b]-metric 1[/b] . Ключ для старой опции [b]VHQ metric: 0 - PSNR[/b] имеет вид: [b]-metric 0[/b]

14. Матрицы квантования выбирайте лучше стандартные для совместимости: [b]Н263[/b] на низких битрейтах до 900 кбит\с и [b]MPEG[/b] для высоких битрейтов с целью улучшения детализации изображения. Хотя моё мнение: матрицу [b]MPEG[/b] надо использовать при коэффициенте качества не ниже 0,21 бит\пиксель и только при двухпроходном кодировании. Помните, что костумные матрицы квантования не поддерживаются большинством железных DVD плейеров.  Для убитых или блочных исходников, а также при кодировании в 1 проход лучше остаться ВСЕГДА на матрице квантования [b]H263[/b] даже на высоких битрейтах. Это касается и старых мультфильмов Cartoon.

15. [b]trellis[/b] оптимизирует процесс квантования для получения оптимального соотношения между PSNR и битпотоком, что позволяет существенно экономить биты. Эти биты впоследствии будут потрачены на другие части видео, что приведет к увеличению общего качества. Следует оставлять эту опцию включенной, поскольку ее влияние на качество хоть незначительно, но есть.

16. ОБЯЗАТЕЛЬНО отключить упаковку p-и b-frames: [b]-nopacked[/b] (об этом официально предупредил Jawor).

17. В случае достаточного битрейта (коэффициент качества > 0.24 бит\пиксель) опцию [b]-vhqmode 4[/b] можно заменить на [b]-vhqmode 1[/b](по умолчанию). Это позволит немного сократить время кодирования.

18. [b]ПРЕДУПРЕЖДЕНИЕ[/b]: Файл [b]xvid_encraw.exe[/b] надо использовать только от билдов [b]Jawora[/b], тот, что лежит в xvidvideo.ru вызывает артефакты.

19. ВНИМАНИЕ: У кодека XviD существует особенность точного попадания в заданный размер или битрейт, которая зависит от качества и уровня шума исходного видео:
а) Если наш исходник зашумленный DVD, камкодер DV, видеоматериалы спутникового или цифрового кабельного телевидения, то ваш пресет кодирования имеет вид:
[code]video codec:
XviD

video cli:
-nopacked -bquant_ratio 162 -bquant_offset 0 -max_bframes 2 -qtype 0 -lumimasking -vhqmode 1 -max_key_interval 250 -zones 0,q,3,O -quality 5 -nochromame -turbo
-nopacked -bquant_ratio 162 -bquant_offset 0 -max_bframes 2 -qtype 0 -lumimasking -vhqmode 4 -max_key_interval 250 -zones 0,w,1,O -bitrate XXXX  -quality 6 -bvhq -vbvmax 4854000 -vbvsize 3145728
[/code]
б) Если наш исходник чистый DVD9, BD, HD DVD, HDTV, AVC HD, HDTV, то во втором проходе настроек кодека надо ввести [i]-imin 1 -pmin 1 -bmin 1[/i] и пресет кодирования приобретает следующий вид :
[code]video codec:
XviD

video cli:
-nopacked -bquant_ratio 100 -max_bframes 1 -qtype 0 -vhqmode 1 -max_key_interval 250 -zones 0,q,3,O -quality 5 -nochromame -turbo
-nopacked -bquant_ratio 100 -max_bframes 1 -qtype 0 -vhqmode 1 -max_key_interval 250 -zones 0,w,1,O -bitrate XXXX  -quality 6 -bvhq -vbvmax 4854000 -vbvsize 3145728 -imin 1 -pmin 1 -bmin 1[/code]

В случае, если ваш стационарный плеер не поддерживает max_bframes более одного "1", следует в обоих проходах установить [b]-max_bframes 1[/b] и в первом случае. 

20. N-Frames.
N-frames представляют собой кадры-пустышки для того чтобы забить место в видеоряде. Основная причина их появления-применение B-frames. Маленькое лирическое оступление:
[quote]При сжатии видео используется 3 типа кадров: I,P и B - frames. I-frames - это кадры с очень небольшим коэффициентом компрессии. Их кодер описывает целиком. I-frames так же называются ключевыми кадрами. При просмотре сжатого фильма, вся навигация по фильму производится через ключевые кадры. После I-frames следует последовательность P-frames, например так: IPPPPPPPPPPPPPPPPIPPPPPPP и так далее. P-frames имеют гораздо больший коэффициент сжатия, т.к. в них кодер сохраняет информацию не обо всей картинке, а только о той ее части, которая изменилась по сравнию с предыдущим кадром. Для того, что бы еще больше повысить коэффициент сжатия, были введены B-frames. Они ставятся между двумя менее сжатыми кадрами (I,P-frames). Последовательность получается такой: IPBPBPBPBPBPBPIPBPBPBP… Коэффициент сжатия B-frames больше, чем коэффициент сжатия P-frames. Это достигается тем, что P-кадр сравнивается только с предыдущим кадром, а B-кадр с 2 окружающими его кадрами, и в B-кадре записывается, чем он отличается от них. Но вместе с этим, это накладывает определённые ограничения. Например, видеопоследовательность не может заканчиваться B-frames. Начинаться же видеоряд должен обязательно с I-кадра, т.к. в нём содержится вся информация об изображении. Итак, с B-frames мы можем сильнее сжать видео. Вы спросите, а причём здесь качество? Всё просто. Сильнее сжали, а размеры видео файла у нас те же самые. Этот "освободившийся" поток перераспределяется на все кадры.
[/quote]
Теперь дальше рассказываю о причине появления и смысла N-Vops.
VirtualDub использует кодеки(кодер-декодеры) VFW. VFW основана на модели "one-frame-in -one-frame-out". Программа читает один кадр с сжатытыми данными от исходного файла, подаёт это к декодеру, декодер развертывает кадр и возвращает несжатый кадр программе. Это работает прекрасно с кодер-декодерами, когда все кадры являются ключевыми I-frames или P-frames. Но используя birectional предсказание, на котором основаны B-frames (некоторые кадры кодируют только различие между собой и более поздним кадром видео) кадры не могут быть расшифрованы должным образом.
Не всегда мы имеем дело с последовательностью IPBBPBBPBBP... или IPBPBPIPBPBPBP…
Иногда возникает последовательность кадров типа IBBP. Это - ордер, где они должны быть рассмотрены, сначала I-frame, затем первый  B-frames, затем  второй B-frames, и наконец  P-frames. I - ключевой кадр, два кадра B  предсказаны от кадра P заранее, и  P-кадр вперед предсказан от I-кадра. Чтобы расшифровать эту последовательность должным образом, вы сначала должны развернуть I-кадр, тогда вы сможете развернуть P-кадр, и наконец  после этого вы можете развернуть два B-кадра. Это путает декодеры VFW, потому что они не могут развернуть P-кадр прежде, чем развернуть B-кадры.
Опция Packed Bitstream работает вокруг этой проблемы, заключая в капсулу последовательность BBP, как будто это - единный кадр, затем добавляя два N (пустых)кадра, как placeholders(занять место): I [BBP] NN. Теперь, когда программа читает последовательность, то сначала cчитывает данные I-кадра, и VFW развертывает это. Затем программа читает последовательность BBP, думая, что это - один кадр видео. Декодер знает, что это - три кадра, таким образом развертывает все три, хранит их внутренне, и возвращает первый развернутый(декомпрессованный) B-кадр программе. Затем программа читает первый N-кадр и передает его декодеру. Декодер игнорирует N-кадр и возвращает второй B-кадр, который уже расшифрован. Наконец программа читает второй N-кадр и передает ее к декодеру. Снова, декодер игнорирует  N-кадр и вручает уже расшифрованный  P-кадр программе.
Теперь что надо сделать, чтобы не было N-frames: да по-просту отключить возможность появления B-frames между I и P кадрами. Опять маленькое лирическое отступления:
[quote]"Frame drop ratito" количество пропускаемых кадров. Эта функция будет работать в том случае, если кодек считает, что для кодирования не хватает битрейта. В этом случае кодер начнёт выкидывать кадры. При выставлении в 0 не пропускается ни одного кадра, при выставлении в 100 пропускается столько кадров, сколько нужно кодеру для нормальной работы. Для получения качественного видео я не рекомендую использовать значения отличные от нуля.
[/quote]
Так вот считается . что установка [b]Frame drop ratito=-1[/b] позволяет нам избежать появления N-Vops, но простому смертному она не доступна и мы пользуемся сборками XviD 1.2.2, например, от Jawor, где это выполнено на программном уровне. Но даже на его сборках в логе мы встречаем появление N-Vops, но реально об их отсутствии или наличии вам может точно сказать программа [url=http://www.videohelp.com/tools/GSpot]GSpot[/url].В сборках XviD 1.3.0 и выше установка опции [b]Frame drop ratito=0[/b] позволяет отключить N-Vops.

===========================================================================

В канун Нового года команда разработчиков провела активную работу над совершенствованием настроек кодека XviD 1.3.0, цитирую одного из них [b]Jawora[/b]:

[quote]1) В начале вышла 1 декабря обновленная версии XviD 1.3.0 билд-127, содержащая некоторые дополнительные VHQ, а именно метрику PSNR HVS-М .
VHQ в ходе своей деятельности должна вычислить "искажение" (разница в качестве между оригиналом и закодированными макроблоками), и это может быть сделано по-разному. До сих пор использовалась метрика [b]PSNR[/b] . Теперь у нас есть альтернатива, то есть [b]PSNR HVS-М[/b]. Эта опция может дать лучшее качество, потому что она стремится принимать во внимание характеристики человеческого зрения (отсюда "HVS" в названии).
Отметьте  галочкой включение данной опции [b]Use PSNR-HVS-M metric for VHQ[/b] на закладке кодека XviD Configuration (т.е. там, где есть также опция VHQ для B-frames). Эта кнопка еще не присутствует в CVS, так что если что добавленная опция может иметь другое имя. (Собственно в билде от 02.01.2011 так и произошло, отныне есть опция [b]VHQ metric[/b] с возможностью выбора варианта метрики: [b]0-PSNR[/b] или [b]1-PSNR-HVS-M[/b]). Я не заметил, разницы в скорости сжатия. Что касается качества, я не проверял его слишком тщательно, но сложилось такое впечатление, что есть небольшой рост.
PSNR HVS-М (и VHQ в целом) не имеет никакой связи с характеристиками декодера, поэтому он может быть использован при сжатии видеоматериала для стационарных DVD плейеров.
Ну, и я ограничил количество потоков до 4, для предотвращения сбоя процессоров с логическими ядерами например, Quad HyperThreadingiem.

2) 7 декабря сборка сегодня по-прежнему основана на источниках от 01/12/2010 CVS, но внес некоторые поправки.
Программа установки содержит целых три версии библиотек xvidcore.dll - "SSE", "SSE+SSE2" и "SSE + SSE2 + SSE3". Они отличаются по оптимизации применяемых при компиляции (конечно, ваш процессор должен поддерживать эти наборы инструкций, чтобы воспользоваться ими.) Версия "SSE + SSE2 + SSE3" может дать ускорение около 3% по сравнению с "SSE".
Xvid планируется работа по внедрению в графический интерфейс для VFW кодека логотипов для каждого профиля "Xvid", но оно еще не готово.

3)vid достигла версии 1.3.а-31.
Сегодня билд включает в себя новый (дополнительный) алгоритм многопоточности. Запустите его, введя значение больше 1 в поле [b]Other options -> Encoder -> Number of slices[/b].
Новый алгоритм делит кадр на "ломтики"(куски или части) (так называемые ломтики ), и каждый из них обрабатывается в отдельном потоке. Он может работать со старым многопоточным алгоритмом, деляший кадр на несколько макроблоков. Если [b]Number of threads = Number of slices[/b] , происходит только деление кадра на ломтики .Если [b]Number of threads > Number of slices[/b] , кадр вначале делится на количество ломтиков "патч", а затем каждый "патч" делится на [b]Number of threads / Number of slices[/b] и каждый из них идет в отдельном потоке.
Два логических ядра процессора дают небольшой прирост скорости, но вот на четырех скорость может увеличиться на 47% (по крайней мере, как видно из испытаний Isibaara). Эксперимент.
Недостатком нового алгоритма является небольшое увеличение спроса на битрейт (0,1-0,9%).
Ну, по-видимому случайные сбои, когда большое число потоков (8 и т.д.) уже отремонтированы.

[i]Наконец подошли к билду, который вызвал вопросы за 25 декабря[/i].
4) ПРЕДУПРЕЖДЕНИЕ: деление на "slices" ( ломтики ) вызывает проблемы с воспроизведением видео на некоторых (возможно, всех) стационарных плейерах. Поверьте мне, я уже знал, о потенциальных проблемах ранее.
Ничего страшного не произошло. Эта функция отключена по умолчанию. Проблемы будут только тогда, когда вы вошли в значение больше 1 для Number of slices. . Ну, а в версия 1.3.x еще имеет статус "нестабильной", так что ожидайте, что проблемы могут появиться в ней.Проблем с декодерами программного обеспечения не будет.
Опять какие-либо изменения в источниках, поэтому сегодня у нас появились новые сборники.
На этот раз, я заблокировал доступ к параметру  [b]Number of slices[/b] (в общем многопоточности на основе ломтиков) во всех профилях, кроме "неограниченного" 
[/quote]
 

Привожу пример пресета кодирования кодеком XviD в заданный битрейт 1500 в один проход с режимом VAQ: 

[code]video codec:
XviD

video cli:
-reaction 60 -averaging 28 -smoother 28 -nopacked -bquant_ratio 162 -bquant_offset 0 -max_bframes 2 -qtype 0 -vhqmode 4 -max_key_interval 250 -bitrate 1500 -bvhq -quality 6  -pmin 1 -bmin 3 -pmax 6 -bmax 8 -lumimasking[/code]

Пресет кодирования кодеком XviD в заданный битрейт 1500 в один проход без VAQ и новой метрики VHQ: 
[code]video codec:
XviD

video cli:
-reaction 60 -averaging 28 -smoother 28 -nopacked -bquant_ratio 162 -bquant_offset 0 -max_bframes 2 -qtype 0 -vhqmode 4 -max_key_interval 250 -bitrate 1500 -bvhq -quality 6  -pmin 1 -bmin 3 -pmax 6 -bmax 8[/code]

Здесь установлены максимальные ограничения по квантам при условии достаточного битрейта, если его явно не хватает, то лучше сменить на пресет с большим битрейтом или снизить разрешение. Возможно и увеличение максимальных квантизеров -pmax 10 -bmax 12, но это приведёт к снижению качества рипа и появлению артефактаблочности изображения. Терпимо, когда максимальные выбросы по квантам не превышают -imax 5 -pmax6 -bmax 8
Для варианта двухпроходного кодирования в заданный битрейт возможности кодека шире за счёт возможного перераспределенния битрейта по разным сценам: 
[code]video codec:
XviD

video cli:
-nopacked -bquant_ratio 100 -max_bframes 1 -qtype 1 -vhqmode 1 -lumimasking -max_key_interval 250 -zones 0,q,3,O -quality 5 -nochromame -turbo
-nopacked -bquant_ratio 100 -max_bframes 1 -qtype 1 -vhqmode 4 -lumimasking -max_key_interval 250 -zones 0,w,1,O -quality 6 -bitrate 1500 -bvhq -vbvmax 4854000 -vbvsize 3145728 -imin 1 -pmin 1 -bmin 1[/code]

В заключении пример двухпроходного кодирования в заданный размер 1,37 ГБ:

[code]video codec:
XviD

video cli:
-nopacked -bquant_ratio 100 -max_bframes 1 -qtype 1 -vhqmode 1 -max_key_interval 250 -zones 0,q,3,O -quality 5 -nochromame -turbo
-nopacked -bquant_ratio 100 -max_bframes 1 -qtype 1 -vhqmode 1 -max_key_interval 250 -zones 0,w,1,O -quality 6 -size 1400000 -bvhq -vbvmax 4854000 -vbvsize 3145728 -imin 1 -pmin 1 -bmin 1[/code]

Помните всегда, что однопроходные пресеты дают худший результат и имеют больший вес артефактов, квантизеры по всем фреймам получаются довольно высокими, так что только воспалённый разум может заставить риппера  установить однопроходное кодирование. Если уж так хочется выполнить скоростной  однопроходный  режим кодирования, подберите битрейт такой, чтобы на выбранном вами разрешении коэффициент качества был не ниже 0,21 бит\пиксель !!! 
Наиболее лучший результат можно получить при кодировании XviD c постоянным квантизером 2 для всех фреймов:
[code]video codec:
XviD

video cli:
-cq 2.0 -qmatrix "C:\Program Files\XviD4PSP 5\presets\matrix\cqm\Jawor_ZSM.cqm" -vhqmode 4 -metric 1 -zones 0,w,1.0,O -nopacked -bvhq -bquant_ratio 100 -bquant_offset 0 -max_key_interval 250 -smoother 0[/code]

Только в данном случае квантизёр для всех кадров – I, P и B и для всех сцен(статических и динамических),-одинаковый. Для этого необходимо задать "Quantizer ratio"равным единице [i]-bquant_ratio 100[/i], а параметр "Quantizer offset" задаём равным нулю  [i]-bquant_offset 0[/i]. В результате получаем:
Квантизёр B-кадров = заданный квантизёр * Quantizer ratio + Quantizer offset. То есть 2 * 1 + 0 = 2, что и требовалось.
Квантизёр P-кадров = Квантизёр I-кадров = заданный квантизёр.

ПРЕДУПРЕЖДЕНИЕ: СЛЕДИТЕ ВНИМАТЕЛЬНО ЗА ПРИМЕНЯЕМЫМИ БИЛДАМИ. НА НЕКОТОРЫХ ПРИ ВКЛЮЧЕНИИ РЕЖИМА [b]VAQ[/b] НАБЛЮДАЕТСЯ КРАХ ИЗОБРАЖЕНИЯ!!!
Не воспринимайте данный опус, как некий постулат. У вас вполне может быть иное мнение, так что сразу прошу вашего критического снисхождения и реальных своих рекомендаций с целью повышения качества кодирования кодеком XviD + VAQ.